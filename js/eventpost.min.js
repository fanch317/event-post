jQuery(window).load(function(){if(typeof ol!=="undefined"){ep_maps=[];ep_vectorSources=[];ep_pop_elements=[];ep_popups=[];ep_features=[];ep_icons=[];ep_proj_source=new ol.proj.Projection({code:"EPSG:4326"});ep_proj_destination=new ol.proj.Projection({code:"EPSG:900913"});ep_interactions=eventpost_params.map_interactions;ep_retina=(window.retina||window.devicePixelRatio>1.5);function c(d){return(eventpost_params.maptiles[d]["urls_retina"]&&ep_retina)}jQuery("a.event_link.gps").click(function(){if(jQuery(this).parent().data("latitude")!==undefined&&jQuery(this).parent().data("longitude")!==undefined){var h=jQuery(this).parent().data("latitude");var i=jQuery(this).parent().data("longitude");var f=jQuery(this).parent().data("marker");var j=jQuery(this).parent().data("id");var e="event_map"+j;var d=new ol.proj.transform([i,h],ep_proj_source,ep_proj_destination);if(jQuery("#"+e).length===0){jQuery(this).parent().append('<div id="'+e+'-wrap"><div id="'+e+'" class="event_map"></div></div>');jQuery("#"+e+"-wrap").css({height:"400px",margin:"auto",clear:"both"}).animate({height:"toggle"},1);ep_vectorSources[e]=new ol.source.Vector();ep_maps[e]=new ol.Map({target:e,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:(c(eventpost_params.defaulttile)?eventpost_params.maptiles[eventpost_params.defaulttile]["urls_retina"]:eventpost_params.maptiles[eventpost_params.defaulttile]["urls"]),tilePixelRatio:(c(eventpost_params.defaulttile)?2:1),attribution:eventpost_params.maptiles[eventpost_params.defaulttile]["attribution"]})}),new ol.layer.Vector({source:ep_vectorSources[e]})],view:new ol.View({center:d,zoom:eventpost_params.zoom})});ep_maps[e].addControl(new ol.control.Zoom());var g=new ol.Feature({geometry:new ol.geom.Point(d)});if(ep_icons[f]===undefined){ep_icons[f]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:f}))})}g.setStyle(ep_icons[f]);ep_vectorSources[e].addFeature(g)}jQuery("#"+e+"-wrap").animate({height:"toggle"},1000,function(){ep_maps[e].getView().setCenter(d)});return false}});function b(d,e){jQuery(ep_pop_elements[d]).hide(0);view=ep_maps[d].getView();var g=e.getGeometry();var h=g.getCoordinates();var f=view.animate({duration:1000,center:h});ep_popups[d].setPosition(h);html_output='<a href="'+e.get("link")+'">'+(e.get("thumbnail")!==""&&e.get("thumbnail")!==undefined?'<img src="'+e.get("thumbnail")+'">':"")+"<strong>"+e.get("name")+"</strong><br><time>"+e.get("date")+"</time><br><address>"+e.get("address")+"</address>"+(e.get("desc")!==""&&e.get("desc")!==undefined?"<p>"+e.get("desc")+"</p>":"")+"</a>";jQuery(ep_pop_elements[d]).delay(500).html(html_output).show(500)}jQuery(".event_geolist").each(function(){var j=jQuery(this).attr("id");var h="event_map_all"+j;var l="event_markersall"+j;var e=jQuery(this).data("width");var m=jQuery(this).data("height");var o=jQuery(this).data("zoom");var k=jQuery(this).data("tile");if(k===""){k=eventpost_params.defaulttile}var g=jQuery(this).data("disabled-interactions");var f='<div id="'+h+'" class="event_map map"></div><div id="'+h+'-popup" class="event_map_popup"></div>';jQuery(this).addClass("event_geolist_parsed");var n=false;if(jQuery(this).hasClass("has-list")){n=jQuery(this).data("list");jQuery(".event_item",jQuery(this)).wrapAll('<div class="eventpost-item-list">');jQuery(".eventpost-item-list a",jQuery(this)).click(function(p){p.preventDefault();feature_selector=j+"-"+jQuery(this).parents(".event_item").first().data("id");console.log(feature_selector);if(ep_features[feature_selector]!=="undefined"){b(h,ep_features[feature_selector])}return false})}if(n==="below"||n==="right"){jQuery(this).prepend(f)}else{jQuery(this).append(f)}css={margin:"auto",clear:"both"};if(e!=="auto"){css.width=e}if(m!=="auto"){css.height=m}if(n==="left"||n==="right"){css.width="70%"}if(n==="above"||n==="below"){jQuery(this).css({height:"auto"})}jQuery("#"+h).css(css);ep_vectorSources[h]=new ol.source.Vector();ep_pop_elements[h]=document.getElementById(h+"-popup");ep_popups[h]=new ol.Overlay({element:ep_pop_elements[h],positioning:"bottom-center",stopEvent:false});map_settings={target:h,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:(c(k)?eventpost_params.maptiles[k]["urls_retina"]:eventpost_params.maptiles[k]["urls"]),tilePixelRatio:(c(k)?2:1),attribution:eventpost_params.maptiles[k]["attribution"]})}),new ol.layer.Vector({source:ep_vectorSources[h]})],view:new ol.View({center:[0,0],zoom:isNaN(o)?12:o,maxZoom:18}),overlays:[ep_popups[h]]};ep_maps[h]=new ol.Map(map_settings);ep_maps[h].addControl(new ol.control.ZoomSlider());ep_maps[h].on("click",function(p){var q=ep_maps[h].forEachFeatureAtPixel(p.pixel,function(s,r){return s});if(q){b(h,q)}else{jQuery(ep_pop_elements[h]).hide(200)}});var d=0;jQuery(this).find("address").each(function(){d++;var s=parseFloat(jQuery(this).data("latitude"));var t=parseFloat(jQuery(this).data("longitude"));jQuery(this).parents(".event_item").first().data("id",d);if(s!==undefined&&t!==undefined){var r=jQuery(this).parent().parent();var p=jQuery(this).data("marker");var u=jQuery(this).data("id");coords=new ol.proj.transform([t,s],ep_proj_source,ep_proj_destination);obj={geometry:new ol.geom.Point(coords),name:r.find("h5").text(),address:jQuery(this).html(),date:r.find("time").text(),link:r.find("a").attr("href"),desc:r.find(".event_exerpt").html()};if(r.find("img").length>0){obj.thumbnail=r.find("img").attr("src")}var q=j+"-"+d;ep_features[q]=new ol.Feature(obj);if(ep_icons[p]===undefined){ep_icons[p]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:p}))})}ep_features[q].setStyle(ep_icons[p]);ep_vectorSources[h].addFeature(ep_features[q])}});ep_maps[h].getView().fit(ep_vectorSources[h].getExtent(),ep_maps[h].getSize());if(!isNaN(o)&&o!==""&&o>0){ep_maps[h].getView().setZoom(o)}m_i=0;var i;for(i in ep_interactions){if(g.indexOf(i+",")>-1){ep_maps[h].getInteractions().getArray()[m_i].setActive(false)}m_i++}})}else{jQuery(".event_geolist").hide()}function a(){jQuery(".eventpost_calendar table td h4").each(function(){event_datas=jQuery(this).next(".event_data");jQuery(this).css({borderColor:event_datas.css("border-left-color"),color:event_datas.css("border-left-color"),backgroundColor:event_datas.css("background-color")})});jQuery(".eventpost_cal_bt").click(function(){var d=jQuery(this).parents(".eventpost_calendar");jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:d.data("cat"),mf:d.data("mf"),dp:d.data("dp"),color:d.data("color"),display_title:d.data("title"),thumbnail:d.data("thumbnail")},function(e){d.html(e);a()})});jQuery(".eventpost_cal_link").click(function(){var d=jQuery(this).parents(".eventpost_calendar");jQuery(".eventpost_cal_list",d).fadeOut(function(){jQuery(this).remove()});jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendarDate",date:jQuery(this).data("date"),cat:d.data("cat"),mf:d.data("mf"),dp:d.data("dp"),color:d.data("color"),display_title:d.data("title"),thumbnail:d.data("thumbnail")},function(e){d.append('<div class="eventpost_cal_list"><button class="eventpost_cal_close">x</button>'+e+"</div>");d.find(".eventpost_cal_list").hide(1).fadeIn(500);d.find(".eventpost_cal_close").click(function(){jQuery(this).parent().hide(500).remove()})})})}jQuery(".eventpost_calendar").each(function(){var d=jQuery(this);d.html('<img src="'+eventpost_params.imgpath+'cal-loader.gif" class="eventpost_cal_loader"/>');jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:jQuery(this).data("cat"),mf:jQuery(this).data("mf"),dp:jQuery(this).data("dp"),color:jQuery(this).data("color"),display_title:jQuery(this).data("title"),thumbnail:jQuery(this).data("thumbnail")},function(e){d.html(e);a()})})});